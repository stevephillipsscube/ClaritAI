<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>59.0</apiVersion>
    <assignments>
        <description>In this resource, the ContentDocumentIDs that were obtained in the previous Get are assigned to a temporary variable.</description>
        <name>Assign_ContentDocument</name>
        <label>Assign ContentDocument</label>
        <locationX>270</locationX>
        <locationY>1679</locationY>
        <assignmentItems>
            <assignToReference>ContentDocumentTemporary.ContentDocumentId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_over_Submissions_Files.ContentDocumentId</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Assign_Record_to_Collection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>In this resource, the ContentDocumentIDs that were obtained in the previous Get License Files are assigned to a temporary variable.</description>
        <name>Assign_License_ContentDocumentID</name>
        <label>Assign License ContentDocumentID</label>
        <locationX>270</locationX>
        <locationY>2195</locationY>
        <assignmentItems>
            <assignToReference>TemporaryLicenseFile.ContentDocumentId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_over_License_Files.ContentDocumentId</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Assign_Record_to_Collection1</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_LinkedEntityId</name>
        <label>Assign LinkedEntityId</label>
        <locationX>138</locationX>
        <locationY>2927</locationY>
        <assignmentItems>
            <assignToReference>LinkedEntityIdSingleRecord.ContentDocumentId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Loop_Over_Records_to_Create.ContentDocumentId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>LinkedEntityIdSingleRecord.LinkedEntityId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Assign_Records_to_Collection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Milestone_ID</name>
        <label>Assign Milestone ID</label>
        <locationX>468</locationX>
        <locationY>755</locationY>
        <assignmentItems>
            <assignToReference>MilestonesIDs</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Over_Completed_Milestones.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Over_Completed_Milestones</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Record_to_Collection</name>
        <label>Assign Record to Collection</label>
        <locationX>270</locationX>
        <locationY>1787</locationY>
        <assignmentItems>
            <assignToReference>NewDocumentLinksToCreate</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>ContentDocumentTemporary</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_over_Submissions_Files</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Record_to_Collection1</name>
        <label>Assign Record to Collection</label>
        <locationX>270</locationX>
        <locationY>2303</locationY>
        <assignmentItems>
            <assignToReference>LicenseFilesCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>TemporaryLicenseFile</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_over_License_Files</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Assign_Records_to_Collection</name>
        <label>Assign Records to Collection</label>
        <locationX>138</locationX>
        <locationY>3035</locationY>
        <assignmentItems>
            <assignToReference>FilesToShareCollection</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>LinkedEntityIdSingleRecord</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Over_Records_to_Create</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>In this assignment, the ID of each Submission is obtained and saved in a Text variable so that it can later be used in a new query to the database.</description>
        <name>Assign_Submission_ID</name>
        <label>Assign Submission ID</label>
        <locationX>270</locationX>
        <locationY>1271</locationY>
        <assignmentItems>
            <assignToReference>SubmissionsId</assignToReference>
            <operator>Add</operator>
            <value>
                <elementReference>Loop_Over_Submissions.Id</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Loop_Over_Submissions</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>In this resource, duplicates of GetPermitFiles and NewDocumentLinksToCreate are being removed, this confirms that the files to be created do not exist in the Permit.</description>
        <name>Get_Unique_Files_IDs</name>
        <label>Get Unique Files IDs</label>
        <locationX>182</locationX>
        <locationY>2495</locationY>
        <assignmentItems>
            <assignToReference>NewDocumentLinksToCreate</assignToReference>
            <operator>RemoveAll</operator>
            <value>
                <elementReference>LicenseFilesCollection</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Size_of_Collection</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Size_of_Collection</name>
        <label>Size of Collection</label>
        <locationX>182</locationX>
        <locationY>2603</locationY>
        <assignmentItems>
            <assignToReference>Count</assignToReference>
            <operator>AssignCount</operator>
            <value>
                <elementReference>NewDocumentLinksToCreate</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Are_there_unique_files_to_create</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Are_there_Completed_Milestones</name>
        <label>Are there Completed Milestones?</label>
        <locationX>611</locationX>
        <locationY>539</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Yes0</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>GetCompletedMilestones</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_Over_Completed_Milestones</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Are_there_Submissions</name>
        <label>Are there Submissions?</label>
        <locationX>380</locationX>
        <locationY>1055</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Yes1</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>GetSubmissions</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_Over_Submissions</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Are_there_unique_files_to_create</name>
        <label>Are there unique files to create?</label>
        <locationX>182</locationX>
        <locationY>2711</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Yes2</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Count</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <numberValue>0.0</numberValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Loop_Over_Records_to_Create</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <environments>Default</environments>
    <interviewLabel>License - Get Submission Files from Related Application {!$Flow.CurrentDateTime}</interviewLabel>
    <label>License - Get Submission Files from Related Application</label>
    <loops>
        <name>Loop_Over_Completed_Milestones</name>
        <label>Loop Over Completed Milestones</label>
        <locationX>380</locationX>
        <locationY>647</locationY>
        <collectionReference>GetCompletedMilestones</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_Milestone_ID</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>GetSubmissions</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_over_License_Files</name>
        <label>Loop over License Files</label>
        <locationX>182</locationX>
        <locationY>2087</locationY>
        <collectionReference>GetLicenseFiles</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_License_ContentDocumentID</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>Get_Unique_Files_IDs</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_Over_Records_to_Create</name>
        <label>Loop Over Records to Create</label>
        <locationX>50</locationX>
        <locationY>2819</locationY>
        <collectionReference>NewDocumentLinksToCreate</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_LinkedEntityId</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>New_Content_Document_Link_records</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_Over_Submissions</name>
        <label>Loop Over Submissions</label>
        <locationX>182</locationX>
        <locationY>1163</locationY>
        <collectionReference>SubmissionsCollection</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_Submission_ID</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>GetSubmissionsFiles</targetReference>
        </noMoreValuesConnector>
    </loops>
    <loops>
        <name>Loop_over_Submissions_Files</name>
        <label>Loop over Submissions Files</label>
        <locationX>182</locationX>
        <locationY>1571</locationY>
        <collectionReference>GetSubmissionsFiles</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Assign_ContentDocument</targetReference>
        </nextValueConnector>
        <noMoreValuesConnector>
            <targetReference>GetLicenseFiles</targetReference>
        </noMoreValuesConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>New_Content_Document_Link_records</name>
        <label>New Content Document Link records</label>
        <locationX>50</locationX>
        <locationY>3227</locationY>
        <inputReference>FilesToShareCollection</inputReference>
    </recordCreates>
    <recordLookups>
        <name>GetApplication</name>
        <label>GetApplication</label>
        <locationX>611</locationX>
        <locationY>323</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>GetCompletedMilestones</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>MUSW__License__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>MUSW__Application2__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>This resource gets the Completed|Approved Milestones related to the Application</description>
        <name>GetCompletedMilestones</name>
        <label>GetCompletedMilestones</label>
        <locationX>611</locationX>
        <locationY>431</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Are_there_Completed_Milestones</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>MUSW__Application2__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>GetApplication.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>MUSW__Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Completed</stringValue>
            </value>
        </filters>
        <filters>
            <field>MUSW__Completed_Action__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Approved</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>MUSW__Milestone__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>GetLicenseFiles</name>
        <label>GetLicenseFiles</label>
        <locationX>182</locationX>
        <locationY>1979</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_over_License_Files</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>LinkedEntityId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>ContentDocumentLink</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Getting the MIlestones&apos;s Submission records</description>
        <name>GetSubmissions</name>
        <label>GetSubmissions</label>
        <locationX>380</locationX>
        <locationY>947</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Are_there_Submissions</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>MUSW__Milestone__c</field>
            <operator>In</operator>
            <value>
                <elementReference>MilestonesIDs</elementReference>
            </value>
        </filters>
        <object>MUSW__Submission__c</object>
        <outputReference>SubmissionsCollection</outputReference>
        <queriedFields>Id</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>GetSubmissionsFiles</name>
        <label>GetSubmissionsFiles</label>
        <locationX>182</locationX>
        <locationY>1463</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_over_Submissions_Files</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>LinkedEntityId</field>
            <operator>In</operator>
            <value>
                <elementReference>SubmissionsId</elementReference>
            </value>
        </filters>
        <filters>
            <field>ContentDocumentId</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>ContentDocumentLink</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <start>
        <locationX>485</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>GetApplication</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>MUSW__Status__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>MUSW__Phase__c</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <object>MUSW__License2__c</object>
        <recordTriggerType>Update</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <variables>
        <description>Variable to save in each iteration the information of the content document</description>
        <name>ContentDocumentTemporary</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ContentDocumentLink</objectType>
    </variables>
    <variables>
        <name>Count</name>
        <dataType>Number</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <scale>0</scale>
        <value>
            <numberValue>0.0</numberValue>
        </value>
    </variables>
    <variables>
        <name>currentItemFromSourceCollection</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ContentDocumentLink</objectType>
    </variables>
    <variables>
        <name>FilesToShareCollection</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ContentDocumentLink</objectType>
    </variables>
    <variables>
        <name>LicenseFilesCollection</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ContentDocumentLink</objectType>
    </variables>
    <variables>
        <name>LinkedEntityIdSingleRecord</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ContentDocumentLink</objectType>
    </variables>
    <variables>
        <name>MilestonesIDs</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>NewDocumentLinksToCreate</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ContentDocumentLink</objectType>
    </variables>
    <variables>
        <name>SubmissionsCollection</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>MUSW__Submission__c</objectType>
    </variables>
    <variables>
        <name>SubmissionsId</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>TemporaryLicenseFile</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>ContentDocumentLink</objectType>
    </variables>
</Flow>
